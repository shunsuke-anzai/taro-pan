<!DOCTYPE html>
<html>
<head>
  <!--
    If you are serving your web app in a path other than the root, change the
    href value below to reflect the base path you are serving from.

    The path provided below has to start and end with a slash "/" in order for
    it to work correctly.

    For more details:
    * https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base

    This is a placeholder for base href that will be replaced by the value of
    the `--base-href` argument provided to `flutter build`.
  -->
  <base href="$FLUTTER_BASE_HREF">

  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="A new Flutter project.">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

  <!-- Force landscape orientation -->
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100vh;
      width: 100vw;
    }

    /* Mobile landscape orientation lock - more aggressive approach */
    @media screen and (orientation: portrait) and (max-width: 767px) {
      html {
        transform: rotate(90deg);
        transform-origin: center;
        position: fixed;
        width: 100vh;
        height: 100vw;
        overflow: hidden;
        top: 0;
        left: 0;
        margin-left: calc((100vw - 100vh) / 2);
        margin-top: calc((100vh - 100vw) / 2);
      }

      body {
        width: 100vh;
        height: 100vw;
        margin: 0;
        padding: 0;
        overflow: hidden;
      }

      /* Flutter specific containers */
      flt-renderer, flt-glass-pane, flutter-view {
        width: 100% !important;
        height: 100% !important;
        transform: none !important;
      }
    }

    /* Desktop and tablet adjustments */
    @media screen and (min-width: 768px) {
      body {
        transform: none !important;
        margin: 0 !important;
        width: 100vw !important;
        height: 100vh !important;
        position: static !important;
      }
    }

    /* Flutter app container */
    flt-glass-pane {
      width: 100% !important;
      height: 100% !important;
    }
  </style>

  <!-- iOS meta tags & icons -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="taro_pan">
  <meta name="screen-orientation" content="landscape">
  <meta name="apple-mobile-web-app-orientation" content="landscape">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png"/>

  <title>taro_pan</title>
  <link rel="manifest" href="manifest.json">
</head>
<body>
  <!-- Landscape orientation notice for mobile users -->
  <div id="orientation-notice" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); color: white; text-align: center; z-index: 9999; font-family: sans-serif;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
      <h2>ğŸ“± ç”»é¢ã‚’æ¨ªå‘ãã«ã—ã¦ãã ã•ã„</h2>
      <p>ã“ã®ã‚²ãƒ¼ãƒ ã¯æ¨ªå‘ãã§ãƒ—ãƒ¬ã‚¤ã—ã¦ãã ã•ã„</p>
      <div style="font-size: 48px; margin: 20px;">ğŸ”„</div>
    </div>
  </div>

  <!-- Fullscreen/PWA button -->
  <button id="fullscreen-btn" style="position: fixed; top: 10px; right: 10px; z-index: 10000; background: rgba(0,0,0,0.7); color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; font-size: 16px;">
    ğŸ” ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³
  </button>

  <!-- Mobile PWA instructions -->
  <div id="pwa-instructions" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); color: white; text-align: center; z-index: 10001; font-family: sans-serif; padding: 20px; box-sizing: border-box;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); max-width: 320px;">
      <h2 id="pwa-title">ğŸ“± ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã§æ¥½ã—ã‚‚ã†ï¼</h2>
      <div style="margin: 20px 0; font-size: 48px;" id="pwa-icon">ğŸ“¤</div>
      <p id="pwa-description">ã‚¢ãƒ—ãƒªã‚’ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã—ã¦ãã ã•ã„</p>
      <div id="pwa-steps" style="margin: 20px 0; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px; font-size: 14px;">
        <!-- Steps will be filled by JavaScript -->
      </div>
      <button onclick="closePWAInstructions()" style="margin-top: 20px; padding: 10px 20px; background: #007AFF; color: white; border: none; border-radius: 5px; font-size: 16px;">
        é–‰ã˜ã‚‹
      </button>
    </div>
  </div>

  <script>
    // Check orientation and show notice if needed
    function checkOrientation() {
      const notice = document.getElementById('orientation-notice');
      const isPortrait = window.innerHeight > window.innerWidth;
      const isMobile = window.innerWidth < 768;

      if (isPortrait && isMobile) {
        // Portrait mode on mobile - show notice
        notice.style.display = 'block';
        // Force rotate the entire page
        document.documentElement.style.transform = 'rotate(90deg)';
        document.documentElement.style.transformOrigin = 'center';
        document.documentElement.style.width = '100vh';
        document.documentElement.style.height = '100vw';
        document.documentElement.style.position = 'fixed';
        document.documentElement.style.top = '0';
        document.documentElement.style.left = '0';
        document.documentElement.style.marginLeft = 'calc((100vw - 100vh) / 2)';
        document.documentElement.style.marginTop = 'calc((100vh - 100vw) / 2)';
      } else {
        notice.style.display = 'none';
        // Reset any transforms
        document.documentElement.style.transform = 'none';
        document.documentElement.style.width = '100vw';
        document.documentElement.style.height = '100vh';
        document.documentElement.style.position = 'static';
        document.documentElement.style.margin = '0';
      }
    }

    // Check on load and resize
    window.addEventListener('load', checkOrientation);
    window.addEventListener('resize', checkOrientation);
    window.addEventListener('orientationchange', function() {
      setTimeout(checkOrientation, 100);
    });

    // Lock orientation if supported
    if (screen.orientation && screen.orientation.lock) {
      screen.orientation.lock('landscape').catch(function(error) {
        console.log('Orientation lock not supported:', error);
      });
    }

    // Detect device and browser
    function getDeviceInfo() {
      const userAgent = navigator.userAgent;
      const isIOS = /iPad|iPhone|iPod/.test(userAgent);
      const isAndroid = /Android/.test(userAgent);
      const isSafari = /Safari/.test(userAgent) && !/Chrome/.test(userAgent);
      const isChrome = /Chrome/.test(userAgent);
      const isFirefox = /Firefox/.test(userAgent);
      const isEdge = /Edge/.test(userAgent);

      return {
        isIOS,
        isAndroid,
        isSafari,
        isChrome,
        isFirefox,
        isEdge,
        isMobile: /Mobi|Android/i.test(userAgent)
      };
    }

    function isStandalone() {
      // iOS Safari PWA detection
      if (window.navigator.standalone === true) {
        return true;
      }

      // Standard PWA detection
      if (window.matchMedia('(display-mode: standalone)').matches ||
          window.matchMedia('(display-mode: fullscreen)').matches) {
        return true;
      }

      // Additional checks for various browsers
      if (window.matchMedia('(display-mode: minimal-ui)').matches) {
        return true;
      }

      // Check if launched from home screen (Android Chrome)
      if (document.referrer === '' || document.referrer.includes('android-app://')) {
        const device = getDeviceInfo();
        if (device.isAndroid && device.isChrome) {
          return true;
        }
      }

      // Check URL parameters that might indicate PWA launch
      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.has('standalone') || urlParams.has('pwa')) {
        return true;
      }

      return false;
    }

    // Close PWA instructions
    function closePWAInstructions() {
      document.getElementById('pwa-instructions').style.display = 'none';
    }

    // Show appropriate PWA instructions
    function showPWAInstructions() {
      const device = getDeviceInfo();
      const pwaInstructions = document.getElementById('pwa-instructions');
      const titleEl = document.getElementById('pwa-title');
      const iconEl = document.getElementById('pwa-icon');
      const descriptionEl = document.getElementById('pwa-description');
      const stepsEl = document.getElementById('pwa-steps');

      let title, icon, description, steps;

      if (device.isIOS && device.isSafari) {
        // iPhone/iPad Safari
        title = 'ğŸ“± ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã§æ¥½ã—ã‚‚ã†ï¼';
        icon = 'ğŸ“¤';
        description = 'Safari ã®å…±æœ‰ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã—ã¦<br><strong>ã€Œãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã€</strong>ã‚’é¸æŠã—ã¦ãã ã•ã„';
        steps = `
          <div style="margin-bottom: 10px;">1ï¸âƒ£ ç”»é¢ä¸‹éƒ¨ã® ğŸ“¤ ã‚’ã‚¿ãƒƒãƒ—</div>
          <div style="margin-bottom: 10px;">2ï¸âƒ£ ã€Œãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã€ã‚’ã‚¿ãƒƒãƒ—</div>
          <div>3ï¸âƒ£ ãƒ›ãƒ¼ãƒ ç”»é¢ã‹ã‚‰ã‚²ãƒ¼ãƒ ã‚’èµ·å‹•</div>
        `;
      } else if (device.isIOS && device.isChrome) {
        // iPhone/iPad Chrome
        title = 'ğŸ“± ã‚¢ãƒ—ãƒªã¨ã—ã¦è¿½åŠ ï¼';
        icon = 'âš¡';
        description = 'Chrome ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰<br><strong>ã€Œãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã€</strong>ã‚’é¸æŠã—ã¦ãã ã•ã„';
        steps = `
          <div style="margin-bottom: 10px;">1ï¸âƒ£ å³ä¸Šã® â‹® ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ã‚¿ãƒƒãƒ—</div>
          <div style="margin-bottom: 10px;">2ï¸âƒ£ ã€Œãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã€ã‚’ã‚¿ãƒƒãƒ—</div>
          <div style="margin-bottom: 10px;">3ï¸âƒ£ ã€Œã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€ã‚’ã‚¿ãƒƒãƒ—</div>
          <div>4ï¸âƒ£ ãƒ›ãƒ¼ãƒ ç”»é¢ã‹ã‚‰ã‚¢ãƒ—ãƒªã‚’èµ·å‹•</div>
        `;
      } else if (device.isAndroid && device.isChrome) {
        // Android Chrome
        title = 'ğŸ“± ã‚¢ãƒ—ãƒªã¨ã—ã¦è¿½åŠ ï¼';
        icon = 'âš¡';
        description = 'Chrome ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰<br><strong>ã€Œãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã€</strong>ã‚’é¸æŠã—ã¦ãã ã•ã„';
        steps = `
          <div style="margin-bottom: 10px;">1ï¸âƒ£ å³ä¸Šã® â‹® ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ã‚¿ãƒƒãƒ—</div>
          <div style="margin-bottom: 10px;">2ï¸âƒ£ ã€Œãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã€ã‚’ã‚¿ãƒƒãƒ—</div>
          <div style="margin-bottom: 10px;">3ï¸âƒ£ ã€Œè¿½åŠ ã€ã‚’ã‚¿ãƒƒãƒ—</div>
          <div>4ï¸âƒ£ ãƒ›ãƒ¼ãƒ ç”»é¢ã‹ã‚‰ã‚¢ãƒ—ãƒªã‚’èµ·å‹•</div>
        `;
      } else if (device.isAndroid && device.isFirefox) {
        // Android Firefox
        title = 'ğŸ“± ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ï¼';
        icon = 'ğŸ¦Š';
        description = 'Firefox ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰<br><strong>ã€Œãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã€</strong>ã‚’é¸æŠã—ã¦ãã ã•ã„';
        steps = `
          <div style="margin-bottom: 10px;">1ï¸âƒ£ å³ä¸Šã® â‹® ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ã‚¿ãƒƒãƒ—</div>
          <div style="margin-bottom: 10px;">2ï¸âƒ£ ã€Œãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã€ã‚’ã‚¿ãƒƒãƒ—</div>
          <div>3ï¸âƒ£ ãƒ›ãƒ¼ãƒ ç”»é¢ã‹ã‚‰ã‚¢ãƒ—ãƒªã‚’èµ·å‹•</div>
        `;
      } else {
        // ãã®ä»–ã®ãƒ–ãƒ©ã‚¦ã‚¶
        title = 'ğŸ“± ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒ¢ãƒ¼ãƒ‰';
        icon = 'ğŸ”';
        description = 'ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§ã¯ä»¥ä¸‹ã®æ–¹æ³•ã‚’ãŠè©¦ã—ãã ã•ã„';
        steps = `
          <div style="margin-bottom: 10px;">ğŸ’¡ F11ã‚­ãƒ¼ã§ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³</div>
          <div style="margin-bottom: 10px;">ğŸ’¡ ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ã€Œå…¨ç”»é¢è¡¨ç¤ºã€</div>
          <div>ğŸ’¡ ã€Œãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã€ãŒã‚ã‚Œã°é¸æŠ</div>
        `;
      }

      titleEl.textContent = title;
      iconEl.textContent = icon;
      descriptionEl.innerHTML = description;
      stepsEl.innerHTML = steps;
      pwaInstructions.style.display = 'block';
    }

    // Fullscreen functionality with cross-platform support
    function toggleFullscreen() {
      const fullscreenBtn = document.getElementById('fullscreen-btn');
      const device = getDeviceInfo();

      // Handle mobile devices specially
      if (device.isMobile && !isStandalone()) {
        showPWAInstructions();
        return;
      }

      const element = document.documentElement;

      function enterFullscreen() {
        const request = element.requestFullscreen ||
                       element.webkitRequestFullscreen ||
                       element.mozRequestFullScreen ||
                       element.msRequestFullscreen;

        if (request) {
          request.call(element).then(function() {
            console.log('Entered fullscreen successfully');
            fullscreenBtn.textContent = 'âŒ çµ‚äº†';
            fullscreenBtn.style.background = 'rgba(255,0,0,0.7)';

            // Auto-hide button after 3 seconds
            setTimeout(function() {
              if (isInFullscreen()) {
                fullscreenBtn.style.opacity = '0.3';
              }
            }, 3000);
          }).catch(function(error) {
            console.error('Fullscreen error:', error);
            const device = getDeviceInfo();
            if (device.isMobile) {
              showPWAInstructions();
            }
          });
        } else {
          const device = getDeviceInfo();
          if (device.isMobile) {
            showPWAInstructions();
          } else {
            alert('ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“');
          }
        }
      }

      function exitFullscreen() {
        const exit = document.exitFullscreen ||
                    document.webkitExitFullscreen ||
                    document.mozCancelFullScreen ||
                    document.msExitFullscreen;

        if (exit) {
          exit.call(document).then(function() {
            console.log('Exited fullscreen successfully');
            fullscreenBtn.textContent = 'ğŸ” ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³';
            fullscreenBtn.style.background = 'rgba(0,0,0,0.7)';
            fullscreenBtn.style.opacity = '1';
          });
        }
      }

      function isInFullscreen() {
        return document.fullscreenElement ||
               document.webkitFullscreenElement ||
               document.mozFullScreenElement ||
               document.msFullscreenElement;
      }

      if (!isInFullscreen()) {
        enterFullscreen();
      } else {
        exitFullscreen();
      }
    }

    // Fullscreen button click handler
    document.getElementById('fullscreen-btn').addEventListener('click', function(event) {
      event.preventDefault();
      event.stopPropagation();
      console.log('Fullscreen button clicked');
      toggleFullscreen();
    });

    // Handle fullscreen change events (cross-browser)
    function handleFullscreenChange() {
      const fullscreenBtn = document.getElementById('fullscreen-btn');
      const isFullscreen = document.fullscreenElement ||
                          document.webkitFullscreenElement ||
                          document.mozFullScreenElement ||
                          document.msFullscreenElement;

      if (isFullscreen) {
        fullscreenBtn.textContent = 'âŒ çµ‚äº†';
        fullscreenBtn.style.background = 'rgba(255,0,0,0.7)';
        console.log('Fullscreen activated');
      } else {
        fullscreenBtn.textContent = 'ğŸ” ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³';
        fullscreenBtn.style.background = 'rgba(0,0,0,0.7)';
        fullscreenBtn.style.opacity = '1';
        console.log('Fullscreen deactivated');
      }
    }

    // Listen to all fullscreen change events
    document.addEventListener('fullscreenchange', handleFullscreenChange);
    document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
    document.addEventListener('mozfullscreenchange', handleFullscreenChange);
    document.addEventListener('MSFullscreenChange', handleFullscreenChange);

    // Show button on mouse move in fullscreen
    document.addEventListener('mousemove', function() {
      const fullscreenBtn = document.getElementById('fullscreen-btn');
      const isFullscreen = document.fullscreenElement ||
                          document.webkitFullscreenElement ||
                          document.mozFullScreenElement ||
                          document.msFullscreenElement;
      if (isFullscreen) {
        fullscreenBtn.style.opacity = '1';
      }
    });

    // Hide fullscreen button if already in standalone mode (PWA)
    function checkAndHideFullscreenButton() {
      const fullscreenBtn = document.getElementById('fullscreen-btn');
      if (isStandalone()) {
        console.log('PWA mode detected - hiding fullscreen button');
        fullscreenBtn.style.display = 'none';
      } else {
        console.log('Browser mode detected - showing fullscreen button');
        fullscreenBtn.style.display = 'block';
      }
    }

    // Check on page load
    window.addEventListener('load', checkAndHideFullscreenButton);

    // Check periodically in case PWA state changes
    setInterval(checkAndHideFullscreenButton, 1000);

    // Check on visibility change (when app is restored)
    document.addEventListener('visibilitychange', function() {
      if (!document.hidden) {
        setTimeout(checkAndHideFullscreenButton, 100);
      }
    });
  </script>

  <script src="flutter_bootstrap.js" async></script>
</body>
</html>
